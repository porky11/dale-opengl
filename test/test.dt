(import gl)
(import glut)
(import macros)

(def render (fn intern void (void)
  (gl.glClear gl.color-buffer-bit)
  (gl.glBegin gl.line-loop);
    (gl.glVertex3f -0.8 -0.8 0.0)
    (gl.glVertex3f -0.8 0.8 0.0)
    (gl.glVertex3f 0.8 -0.8 0.0)
    (gl.glVertex3f 0.8 0.8 0.0)
  (gl.glEnd)
  (gl.glFlush)
  (return)))

(using-namespace std.macros
(def make-const (macro intern (expr)
  (let ((type \ (type-of mc expr true)))
    (printf "Type::\n")
    (print type)
    (printf "\n")
    (qq cast (uq expr) (const (uq type))))))
)

(def main (fn extern-c int ((argc int) (argv (p (p char))))
  (glut.glutInit (# argc) argv)
  (glut.glutInitDisplayMode (| glut.depth (| glut.single glut.rgba)))
  (glut.glutInitWindowPosition 100 100)
  (glut.glutInitWindowSize 500 500)
  (glut.glutCreateWindow "My First openGL Program")
  (glut.glutDisplayFunc (make-const (# render)))
  (glut.glutMainLoop)
  (return 0)))


